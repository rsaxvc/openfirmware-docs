<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><!-- Template 03-24-01 --><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
            <meta id="book-resource-type" name="book-resource-type" content="Technical Note">
            <meta id="book-title" name="book-title" content="Fundamentals of Open Firmware, Part I: The User Interface">
            <meta id="book-root" name="book-root" content="./">
            <meta id="devcenter" name="devcenter" content="Mac Dev Center">
            <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/mac">
            <meta id="reflib" name="reflib" content="Documentation Archive">
            <meta id="book-assignments" name="book-assignments" content="{Type/Technical Note}">
            <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/DTS10002902">
            <meta id="document-version" name="document-version" content="1.0.3">
            <meta id="build" name="build" content="c1e4c7a89af8f899a21cfa81fc33ba42">
            <meta id="description" name="description" content="TN1061: Describes the Open Firmware User Interface, Forth and the Open Firmware language used in Apple products.">
            <meta id="resources-uri" name="resources-uri" content="../../Resources/1282/">
            <meta id="Generator" name="Generator" content="Gutenberg Static e43202ea08">
            <meta id="Copyright" name="Copyright" content="Copyright 2018 Apple Inc. All Rights Reserved.">
			<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
            <meta id="platforms" name="platforms" content="OS X">
<link rel="stylesheet" type="text/css" href="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/screen.css">
<link rel="stylesheet" type="text/css" href="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/feedback.css">


<link rel="stylesheet" href="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/adcstyle_002.html" type="text/css" id="custom">
<link rel="stylesheet" href="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/style.html" type="text/css" id="custom">

<title>Technical Note TN1061: Fundamentals of Open Firmware, Part I: The User Interface</title>
    <meta name="keywords" content="Mac OS 8 Open firmware Forth connecting two machine mode">
    <meta name="Description" content="Technical Note TN1061: This Technical Note describes the
Open Firmware User Interface and Forth, the Open Firmware
language. This Note addresses how to connect the target machine
to a host machine for two machine mode. It explains how to
use the interface to go between two and one machine mode.
It also provides an explanation of the basics of Forth, an
introduction to the device tree, and some debugging techniques.">


<meta name="categories" content="Hardware">


<meta name="week-posted" content="Jul 1, 1996 - Jul 5, 1996">

<link rel="stylesheet" href="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/adcstyle.html" type="text/css" id="custom"><script language="JavaScript" type="text/javascript" src="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/adc.html"></script>
</head>


<body id="StaticPage" class="" bgcolor="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002902" title="Fundamentals of Open Firmware, Part I: The User Interface"></a>

            <div id="adcHeader" class="hideOnPrint hideInXcodeSC">
                <div id="ssi_Header" class="hideInXcodeSC unified">
                    <a id="ssi_LibraryTitle" href="https://developer.apple.com/library/archive/navigation/">Documentation Archive</a>
                    <a id="ssi_AppleDeveloperConnection" href="https://developer.apple.com/">Developer</a>
                    <div id="ssi_SearchButton" role="button" title="Search">Search</div>
                </div>
                <form id="ssi_SearchMenu" method="get" action="../../search/" accept-charset="utf-8">
                    <label for="adcsearch">Search Documentation Archive</label>
                    <input type="search" id="ssi_SearchField" name="q" accesskey="s" results="5">
                </form>
            </div>
            <header id="header">
                <div id="title" role="banner">
                    <h1>Fundamentals of Open Firmware, Part I: The User Interface</h1>
                    <span id="file_links">
                        <a id="PDF_link" role="button" tabindex="4" rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                        <a id="Companion_link" role="button" tabindex="3" title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
                    </span>
                </div>
                <ul id="headerButtons" class="hideOnPrint" role="toolbar">
                    <li id="toc_button" style="display:none">
                        <button tabindex="5" id="table_of_contents" class="" role="checkbox" aria-label="Show Table of Contents">
                        <span class="disclosure"></span>Table of Contents</button>
                    </li>
                    <li id="jumpto_button" style="display:none" role="navigation">
                        <select tabindex="6" id="jumpTo">
                            <option value="top" selected="selected">&lt;&gt;</option>
                        </select>
                    </li>
                    <li id="downloadSample_button" style="display:none">
                        <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
                    </li>
                </ul>
            </header>
            <nav id="tocContainer" class="" tabindex="7">
                <ul id="toc" role="tree"></ul>
            </nav>
            <article id="contents" class="">
              <div id="technical">
<a name="top"></a>
<!-- begin_header_information --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="https://developer.apple.com/library/archive/referencelibrary/index.html">Reference Library</a> &gt; <a href="https://developer.apple.com/library/archive/technicalnotes/index.html">Technical Notes</a> &gt; <a href="https://developer.apple.com/library/archive/technicalnotes/HardwareDrivers/index.html">Hardware &amp; Drivers</a> &gt; <a href="https://developer.apple.com/library/archive/technicalnotes/HardwareDrivers/idxPCIandPCCard-date.html">PCI and PC Card</a> &gt; </p><!-- end_header_information -->
<!-- bottom_of_header_marker_comment -->
<!-- top_of_titles_marker_comment --><center><table width="600" cellspacing="0" cellpadding="0" border="0">
<tbody><tr><td scope="row" align="left">
<h1>
<div id="pagehead">Technical Note TN1061</div>
<div id="pageheadsub">Fundamentals of Open Firmware, Part I: The User Interface</div>
</h1>
</td></tr></tbody></table></center><!-- bottom_of_titles_marker_comment -->

<center><table width="600" cellspacing="1" border="0"><tbody><tr><td align="left">
 <!-- begin_header_box -->
 <table width="600" cellspacing="0" cellpadding="0" border="0">
	<tbody><tr>
		<td scope="row" width="300" valign="top" align="left">
			<table width="300" cellspacing="0" cellpadding="0" border="0">
			<tbody><tr>            
            <td width="300" align="left"> <img src="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/tnmenutop.gif" alt="" width="300" height="7" align="bottom"></td>
				</tr>
				<tr bgcolor="#e6e6e6">
					<td width="300" background="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/tnmenubody.gif" align="left">
						<span id="menutitle">
							CONTENTS 
                            <br>
                            <br>
						</span>
					</td>
				</tr>
				<tr bgcolor="#e6e6e6">
					<td width="300" background="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/tnmenubody.gif" align="left">
<!-- begin_toc -->
<p id="menutext">
<a href="#RTFToC1">About the Open Firmware User Interface</a><br><br>
<a href="#RTFToC2">Connecting for Two-Machine Mode</a><br><br>
<a href="#RTFToC3">An Introduction to Forth</a><br><br>
<a href="#RTFToC4">The Device Tree</a><br><br>
<a href="#Summary">Summary</a><br><br>
<a href="#References">References</a><br><br>
<a href="#Downloads">Downloadables</a></p>
<!-- end_toc --> 			
					</td>
				</tr>
				<tr>
					<td scope="row" width="300" align="left">
						<img src="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/tnmenubottom.gif" alt="" width="300" height="16">
					</td>
				</tr>
			</tbody></table>
		</td>
		<td width="300" valign="top" align="left">	
		<!-- begin_intro_text -->
<p id="introtext">
This Technote describes the Open Firmware User Interface and Forth, the Open
Firmware language. This Note addresses how to connect the target machine to a
host machine for two machine mode. It explains how to use the interface to go
between two and one machine mode. It also provides an explanation of the basics
of Forth, an introduction to the device tree, and some debugging techniques.</p>

<p id="introtext">
This Technote is targeted at the expansion device designer and the driver
writer for that device. The reader should have an understanding of Open
Firmware as described by the IEEE 1275-1994 Specification, the PCI Local Bus
Specification 2.0+, the PCI Bus Binding Specification 1.5, and <i>Designing PCI
Cards and Drivers for Power Macintosh Computers</i>.</p>

<p id="introtext">This purpose of this Technote is to supplement the sparse documentation covering Open Firmware on the Macintosh.</p>

<center><table width="275" border="0">
<tbody><tr><td bgcolor="#E6E6E6" align="left">
<p id="introtext"><b>Note:</b><br>
A Technote is insufficient to explain all features of Open Firmware that
are required by a driver writer and/or a board designer to comprehend, in order
to complete an expansion device project.</p>
</td></tr></tbody></table></center><br>


<center><table width="275" border="0">
<tbody><tr><td bgcolor="#E6E6E6" align="left">
<p id="introtext"><b>Note:</b><br>
This Note is written using a 9500 Macintosh. Your machine may be somewhat
different with respect to display output. For instance, the 9500 PCI series
machines are PCI Local Bus Specification 2.0 compliant. Newer machine may be
compliant to version 2.1.</p>
</td></tr></tbody></table></center>
<!-- end_intro_text -->
<!-- begin_date -->
<h3>&nbsp;Updated: [Jul 01 2000]</h3>
<!-- end_date -->
                </td>
             </tr>
          </tbody></table>
          <!-- end_header_box -->
 <br><br>
<hr width="500" align="center">
          <br><br>
 <!-- begin_content -->
<a name="RTFToC1"></a>
<h2>About the Open Firmware User Interface</h2>

<p><b>Open Firmware</b> is the process that controls the microprocessor after
hardware initialization and diagnostics are performed, but before the main
Operating System is passed control. It is responsible, among other things, for
building the device tree and probing the expansion slots for I/O devices. Open
Firmware queries PCI devices for its address space needs and dynamically
assigns this space to each device. It is during this probing process that each
device and motherboard ASIC is given a node in the device tree.</p>

<p><b>Nodes</b>, which are also called <b>packages</b>, contain <b>properties</b>
and <b>methods</b>. <b>Properties</b> are attributes that describe the hardware
and driver. <b>Methods</b> do work much like subroutines or procedures. The
hardware and software engineer can use the Open Firmware user interface to
debug their device and driver, respectively. See <a href="https://developer.apple.com/library/archive/technotes/tn/tn1044.html">Technote 1044,
</a><i>Understanding PCI Expansion Choices for Mac OS 8, Part III </i> in the Open Firmware
Technote Series, for details about properties and methods for various
devices. You must be able to traverse the device tree to get to your node and
then to edit and debug that node.</p>

<p><b>Forth</b> is the human interface language to Open Firmware and the device
tree. If you're a board designer, you'll want to directly read and write
registers on your device, and, therefore, must be able to move throughout the
device tree, create and delete words, etc. The driver writer has similar needs
and must also build an <b>FCode</b> representation of the driver properties and
methods. If the device contains a <b>boot driver</b>, that driver must be
debugged using the Open Firmware user interface.</p>

<p>A <b>boot driver</b> is written in Forth, then tokenized into FCode and
debugged from the interface. This form of driver is used during the earliest
stages of the boot process before an operating system is available. Boot
drivers are typically display, keyboard, network, and block, but are not
limited to these.</p>

<p>The Open Firmware user interface, therefore, as specified by the IEEE1275-1994
Specification, is required to allow board designers and driver writers access
to their hardware and software to build and debug their expansion device
project. Let's see how that works.</p>

<p><a href="#top">Back to top</a></p>
<a name="RTFToC2"></a>
<h2>Connecting for Two-Machine Mode</h2>

<p>The Open Firmware user interface, hereafter called the interface, as
implemented on Macintoshes to date, comes up in two-machine mode. You can
connect the two machines together using the serial ports and cable. Start with
the modem ports for simplicity. Open Firmware defaults to the modem port. Use a
communication application such as Zterm, MacTerminal, or Microphone as the
host. Use these settings:</p>

<ul>
<li>38400 baud (typically 38.4 but some versions of OF may use 19.2 also)</li>
<li>No parity</li>
<li>8 data bits</li>
<li>1 stop bit</li>
<li>XON/XOFF handshake</li>
<li>ANSI/VT102 terminal protocol</li>
</ul>


<ol>
<li>Start the host and wait for the prompt.</li>
<li>Start the target machine while holding down the O, F, Option, and Command
keys. (O, F stands for Open Firmware.) </li>
<li>Wait until you see: </li>
</ol>
<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>Open Firmware, 1.0.5
To continue booting the MacOS type:
BYE
To continue booting from the default boot device type:
BOOT
ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>


<p>(This prompt will vary depending on the version of  OF running on the machine.
For example, some newer machines, OF version is 2.0.x.)</p>

<p>The O.K. means the interpeter is waiting for keyboard input. The 0 indicates
the top of the stack.</p>

<h3>Going between one and two machine modes</h3>

<p>To move from two machine to one machine mode during an individual session,
enter the following redirection words: </p>
<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; " pci2/@f" output    \ the path must point to your display node
0 &gt; " kbd" input
</pre>
	</td>
</tr>
</tbody></table></center>

<br><center><table width="550" border="0">
<tbody><tr><td bgcolor="#E6E6E6" align="left">
<p><b>Note:</b><br>
" kbd" is standard alias supported on all the machines. But there is no
standard alias for display screen. The redirection of output is specific to
power surge machines. You will have to decide what is the display for the
target machine and use that path name.</p>
</td></tr></tbody></table></center><br>





<p>Now, I must point out that after the output was directed to the target machine
what you enter at the host for the second word ( i.e., input ) will not appear
on your host display but on your target display. You can now enter you session
on the target machine until you restart your target. Once you restart, your
input and output capabilities will again be at the host. To make the change
permanent, used the printenv and setenv words. What follows is what the
printenv word displays. Note that there are two untitled columns. The left
column displays current setting and the right diplays the default. You must
change the environmental variables called input-device and output-device to
contain the path name to your keyboard and display, respectively. Then, when you
restart your target, you'll always be in one machine mode. Of course, since
these variables are stored in NVRAM, you can reset them using the
Option-Command-P-R keys upon restart. I'll leave this procedure to you, but
let's look at one more variable.</p>

<p><b>Auto-boot?</b> is its name and if you set auto-boot? to false, you no longer
have to hold down the Option-Command-O-F keys upon restart.</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; printenv

little-endian?      false               false
real-mode?          false               false
auto-boot?          true                true
diag-switch?        false               false
fcode-debug?        false               false
oem-banner?         false               false
oem-logo?           false               false
use-nvramrc?        true                false
real-base           -1                  -1
real-size           100000              100000
virt-base           -1                  -1
virt-size           100000              100000
load-base           4000                4000
pci-probe-list      -1                  -1
screen-#columns     64                  64
screen-#rows        28                  28
selftest-#megs      0                   0
boot-device         /AAPL,ROM           /AAPL,ROM
boot-file
diag-device         fd: diags            fd: diags
diag-file
input-device        ttya                ttya
output-device       ttya                ttya
oem-banner
oem-logo
boot-command        boot                boot
ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p align="center">
You are ready to use the interface and at this point and a few words about
Forth are needed.
</p>

<p><a href="#top">Back to top</a></p>

<a name="RTFToC3"></a>
<h2>An Introduction to Forth</h2>

<p align="center">
Forth is a stack-based interpretive language that uses reverse Polish notation.
You place operands onto the stack and then operate on the operands by entering
words. Words are delimited by white spaces.
</p>


<h3>Your First Forth Operation</h3>
<p align="center">
Let's look at a simple example using four function arithmitic. We will add 5
and 7 to get 12.
</p>

<ol>
<li>Enter 5 CR (carriage return),</li>
<li>enter 7 CR</li>
<li>enter + CR</li>
<li>enter . CR</li>
</ol>

<p align="center">
Your display should now look as follows: 
</p>


<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 5  ok
1 &gt; 7  ok
2 &gt; +  ok
1 &gt; . C  ok
</pre>
	</td>
</tr>
</tbody></table></center>

<p align="center">
. . . But where is the correct answer, which is 12?
</p>


<p><b>Setting Forth's Numeric Base</b></p>

<p>
The C means 0xC for hexidecimal. The Open Firmware user interface defaults to a
hexidecimal numeric-base. The radix can be hexidecimal, decimal, or octal and
can be changed as follows: 
</p>


<table width="300" cellspacing="1" cellpadding="4" align="CENTER">

<tbody><tr>
<td width="180" valign="top" align="left">
hex</td>
<td width="420" valign="top" align="left">
means interpet all input and output in hexidecimal.</td>
</tr>

 <tr>
<td width="180" valign="top" align="left">
decimal</td>
<td width="420" valign="top" align="left">
means interpet all input and output in decimal.</td>
</tr>

<tr>
<td width="180" valign="top" align="left">
octal </td>
<td width="420" valign="top" align="left">
means interpet all input and output in octal.</td>
</tr>
</tbody></table>

<p align="center">
If you want to change only the next input or output character and then return
to the existing numeric-base, use these words.
</p>


<table width="300" cellspacing="1" cellpadding="4" align="CENTER">

<tbody><tr>
<td width="180" valign="top" align="left">
h#</td>
<td width="420" valign="top" align="left">
means interpet the following number as hexadecimal.</td>
</tr>
<tr>
<td width="180" valign="top" align="left">
d# </td>
<td width="420" valign="top" align="left">
means interpet the following number as decimal.</td>
</tr>
<tr>
<td width="180" valign="top" align="left">
o# </td>
<td width="420" valign="top" align="left">
means interpet the following number as octal.</td>
</tr></tbody></table>

<p>Also, there is the .d and .h equivalent words for displaying.</p>

<p>
To display the current base, output in decimal, enter: 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; base @ .d 16k
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>At this point, all the following numbers in this Technote will be decimal for
convienence.</p>

<p>
Try the above example again, but this time begin by changing the default to
decimal, and your results will look like the following: 
</p>


<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; decimal  ok
0 &gt; 5  ok
1 &gt; 7  ok
2 &gt; +  ok
1 &gt; . 12  ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>
Since Forth interpets a word using white space delimiters, we can type more
than one word on a line as follows: 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 5 7 + . 12  ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<h3>The .s Word</h3>

<p>
Now try the same commands, substituting the &lt;.&gt; with a &lt;.s&gt;.
Actually, you enter a period for &lt;.&gt;. 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 5 7 + .s 12
ok
1 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>
This shows us two things: 
</p>

<ol>
<li>Forth words can be punctuation marks, or even numbers; from now on in this
Technote, we will surround Forth words with &lt;&gt;, for clarity.</li>
<li>&lt;.s&gt; displays the entire stack without removing items from the stack,
while &lt;.&gt; displays the top item on the stack and removes it.</li>
</ol>

<p>For instance, look at the following sequence of numbers and words.</p>
<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 1 2 3 4 . 4  ok
3 &gt; .s 1 2 3
ok
3 &gt; . . .  3 2 1  ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>
1 then 2 then 3 then 4 were put onto the stack, and then the top item, 4, was
displayed. &lt;.&gt; removed the 4 and displayed it. This made the stack depth
go to 3. When &lt;.s&gt; was entered, the entire stack was displayed, but no
item was removed. &lt;.s&gt; is very useful when debugging, since it can let
you see what you actually entered onto the stack before executing a word.
</p>


<h3>Unknown Words</h3>

<p>
The Forth Interpeter is not forgiving about clearing the entire stack when you
type a word the interpeter doesn't understand. This can be very frustrating, as
shown in the next example.
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 1 2 3 4   ok
4 &gt; bad-word bad-word, unknown word
ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>
Since bad-word is not a word in the Forth dictionary, the interpeter cleared
the entire stack. Usually, there are ways to return to a command when this
occurs.  Open Firmwares terminal emulator allows the use of the arrow keys to
return to previous lines so that you may edit a line before trying the
offending or unknown word.
</p>


<h3>More Forth Words</h3>

<p>
You can determine the depth of the stack, clear an item, clear the entire
stack, rotate an item, etc. All of these commands are detailed in Section 7,
User Interface, of the IEEE 1275 Specification. Look at the following: 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 1 2 3 4 depth .s 1 2 3 4 4
ok
5 &gt; clear .s Empty
ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>Four numbers were placed on the stack and then the &lt; depth &gt; word was
executed. As you might expect, this word determined how deep the stack was and
then placed that number on the top of the stack. &lt;.s&gt; displayed the
entire stack, including the result of &lt; depth &gt;. &lt; clear &gt; returned
the stack depth to zero, as can be seen by its output (i.e., Empty) when
displayed with the &lt; .s &gt; word.</p>

<h3>Stack Notation</h3>

<p>But how do you know what a word does before executing it? Stack notation is the
answer. Forth stack notation is a formal statement of what is on the stack
before and after the word is executed. It does not report the stack contents
below what is needed by the word. Each word has a notation that attempts to
clarify what the word does. The stack notations for &lt; + &gt; and &lt; depth
&gt; are shown next.</p>

+ ( nu1 nu2 -- sum )<br>
depth ( -- u )<br>

<p>Now, let's look at the format of a stack notation. It begins with the &lt; (
&gt; led and followed by a white space, so it's a word. It informs the Forth
enterpeter to ignore all characters until it sees the &lt; ) &gt; word, which
does not need to be delimited by white spaces at the beginning and end of
itself. The -- is a separator of the item on the stack before and after
execution of a word. Item(s) to the left are on the stack before the word is
executed and item(s) to the right are placed on the stack by the word.</p>
So &lt; + &gt; then takes the two top most values off the stack, adds them, and
returns the sum to the stack. Note that there can be many more values on the
stack below the two topmost in this example. &lt; depth &gt; determines the
number of values on the stack and places an unsigned number on the top of the
stack.

<h3>Duplication, Rearrangement, and Removal of Stack Items</h3>

<p>So far we have looked at items or values on the stack. A single stack value may
not be sufficient to describe an item. Some items have two or more values.
Let's look at stack duplication, rearrangement, and removal of single and
double stack items next. Enter the following command line: </p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 1 2 3 4  ok
4 &gt; dup  ok
5 &gt; .s 1 2 3 4 4
ok
5 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>So &lt; dup &gt; duplicated the top item on the stack, which can be seen from
entering the &lt; .s &gt; command.</p>

<p>
Now enter the following: 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>5 &gt; clear 1 2 3 2dup .s 1 2 3 2 3
ok
5 &gt; 3dup .s 1 2 3 2 3 3 2 3
ok
8 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>&lt; clear &gt; emptied the stack, 1 2 3 were entered, and then the 2 and 3
were duplicated using the &lt; 2dup &gt; word. The stack then produced 1 2 3 2
3 when &lt; 3dup &gt; was entered. At this point there were eight items on the
stack.</p>

<p>Next, remove those items: </p>
<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>8 &gt; drop .s 1 2 3 2 3 3 2
ok
7 &gt; 2drop .s 1 2 3 2 3
ok
5 &gt; 3drop .s 1 2
ok
2 &gt; nip .s 2
ok
1 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>You can drop one, two, or three items from the stack and you can nip it also as
shown above. Here are the stack notations for your analysis of the previous
example: </p>

<table width="300" cellspacing="1" cellpadding="4" border="0" align="CENTER">

<tbody><tr>
<td width="180" valign="top" align="left">
drop</td>
<td width="420" valign="top" align="left">
( x -- )</td>
</tr>

 <tr>
<td width="180" valign="top" align="left">
2drop</td>
<td width="420" valign="top" align="left">
( x1 x2 -- )</td>
</tr>

<tr>
<td width="180" valign="top" align="left">
3drop </td>
<td width="420" valign="top" align="left">
( x1 x2 x3 -- )</td>
</tr>

<tr>
<td width="180" valign="top" align="left">
nip </td>
<td width="420" valign="top" align="left">
( x1 x2 -- x2 )</td>
</tr>
</tbody></table>

<p>
&lt; nip &gt; removed the second item. Here is the stack notation for clear. 
</p>

<table width="300" cellspacing="1" cellpadding="4" border="0" align="CENTER">
<tbody><tr>
<td width="180" valign="top" align="left">
clear </td>
<td width="420" valign="top" align="left">
( ... -- )<br>that is, &lt; clear &gt; removes all items as can be seen above. So
the elipse means " all items ".</td>
</tr>
</tbody></table>

<p>The stack can also be rearranged, as follows: </p>
<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 1 2 3 4 .s 1 2 3 4
ok
4 &gt; rot .s 1 3 4 2
ok
4 &gt; -rot .s 1 2 3 4
ok
4 &gt; swap .s 1 2 4 3
ok
4 &gt; 2swap .s 4 3 1 2
ok
4 &gt; clear  ok
0 &gt;

rot         ( x1 x2 x3 -- x2 x3 x1 ) rotated top three items
-rot         ( x1 x2 x3 -- x3 x1 x2 ) the other way
swap        ( x1 x2 -- x2 x1 )
2swap        ( x1 x2 x3 x4 -- x3 x4 x1 x2 )
</pre>
	</td>
</tr>
</tbody></table></center>


<br><center><table width="550" border="0">
<tbody><tr><td bgcolor="#E6E6E6" align="left">
<p><b>Note:</b><br>
For a complete list of user interface words, see the IEEE 1275
Specification, the PCI Binding for words specific to PCI, and Designing PCI
Cards and Drivers for Power Macintosh Computers for Apple defined words.</p>
</td></tr></tbody></table></center><br>


<p>There are two more words that you will find useful when debugging. One is for
comments and the other is to extend the dictionary with a new or redefined
word.</p>

<p>Here is the display string word &lt; ." &gt;. When the interpeter sees this
word, it inputs the following text string. When it sees &lt; " &gt; delimiter,
it exits this mode and displays the string contained between the &lt; ." &gt;
and the delimeter ". Here's an example.</p>
<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; ." Hello world, I'm an example " Hello world, I'm an example  ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>What was entered was echoed. Here is the first word that did not take its
operand from the stack. It took all characters until a &lt; " &gt; was seen.
Here is the stack notation.</p>

<p>."    ( [text&lt;"&gt;] -- )</p>

<p>
The [ ] pair says to take all text until a ". Can be confusing huh?
</p>

<p>Here is the new or redefine word. It is called a <b>colon definition</b> and
looks like this: </p>

<p>: + ." I don't do addition " ; Look at ." I don't do addition ". This is just a
string. The &lt; : &gt; started the definition of a word called &lt; + &gt;
that echoes the string and the &lt; ; &gt; ended the definition. Look at this
example.</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; 1 2 3 + .s 1 5
ok
2 &gt; : + ( -- ) ." I don't do addition " ;  ok
2 &gt; + I don't do addition  ok
2 &gt; forget +  ok
2 &gt; +  ok
1 &gt; . 6  ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>
Can you tell what happened?
</p>

<ol>
    <li>    1 2 3 were entered, and then the contents of the stack were displayed.</li>
    <li>    The + operator was redefined to do nothing but type a string to the display
and leave the contents of the stack as it was. That's the reason for the stack
notation ( -- ) which stands for " stack contents unaffected".</li>

<li>After the first addition the stack had a 5 on the top with a 1 below it. The
new definition of &lt; + &gt; did nothing to the stack.</li>

    <li>    Here's a new word called &lt; forget &gt; which forgets the most recent
definition and all words defined since that word.</li>
</ol>

<br><center><table width="550" border="0">
<tbody><tr><td bgcolor="#E6E6E6" align="left">
<p><b>Note:</b><br>
The old definition of + was not replaced, just superceded. This
implies that the dictionary places new definitions at the top and also searches
for words starting at the top.</p>
</td></tr></tbody></table></center><br>


<p>
That's enough general Forth language and stack information to get you started
with the device tree, which we turn to next.
</p>

<p><a href="#top">Back to top</a></p>

<a name="RTFToC4"></a>
<h2>The Device Tree</h2>

<p>
The <b>device tree</b> is constructed by the Open Firmware probing process
before the main Operating System is given control. It contains nodes for each
ASIC on the motherboard, nodes for expansion devices such as yours, and a set
of utilities nodes. For example /packages and /aliases.  The root of the tree
is /. To get to the root node and list the entire tree, enter the following: 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>dev / ls
</pre>
	</td>
</tr>
</tbody></table></center>

<p>
&lt; dev &gt; is a word which opens a node in the tree and the particular node
in this example is the root or /. This is a bus node for the AR bus (Apple
RISC). &lt; ls &gt; lists all nodes, if any, under the present node. Let's see
how that works: 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; dev / ls
86746496: /PowerPC,604@0
86747184:   /l2-cache@0,0
86749168: /chosen@0
86749472: /memory@0
86749800: /openprom@0
86749992: /AAPL,ROM@FFC00000
86750528: /options@0
86752280: /aliases@0
86752856: /packages@0
86752992:   /deblocker@0,0
86755040:   /disk-label@0,0
86756384:   /obp-tftp@0,0
86765664:   /mac-files@0,0
86767704:   /mac-parts@0,0
86769592:   /aix-boot@0,0
86770736:   /fat-files@0,0
86776320:   /iso-9660-files@0,0
86778696:   /xcoff-loader@0,0
86781192:   /terminal-emulator@0,0
86781344: /bandit@F2000000
86785936:   /gc@10
86787016:     /53c94@10000
86793296:       /sd@0,0
86796416:       /st@0,0
86799608:     /mace@11000
86803312:     /escc@13000
86803656:       /ch-a@13020
86805368:       /ch-b@13000
86807080:     /awacs@14000
86807312:     /swim3@15000
86811672:     /via-cuda@16000
86814632:       /adb@0,0
86814872:         /keyboard@0,0
86816744:         /mouse@1,0
86816920:       /pram@0,0
86817096:       /rtc@0,0
86818320:       /power-mgt@0,0
86818608:     /mesh@18000
86825624:       /sd@0,0
86828744:       /st@0,0
86832080:     /nvram@1D000
86839664:   /pci106b,1@B
86840136:   /ATY,XCLAIM@D
86876008:   /wayne.device@E
86878936:   /wayne.device@F
86832488: /bandit@F4000000
86882192:   /pci106b,1@B
86882664:   /pci1234,5678@D
86883440:   /TRUV,TARGA2000PCI@F
86837184: /hammerhead@F8000000
ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>Take a close look at the tree and then go into your Developer Notes for the
9500 Macintosh. Notice that this resembles the block diagram on the 9500. It is
the block diagram and more. Note that there are two nodes called bandit. One is
/bandit@F2000000 and the other is /bandit@F4000000<tt>. </tt>These are full
path names. One can deduce that full path names can contain address
information, such as @F40000000, when the name is not unique, such as bandit.
Bandit is the PCI bridge chip that has the AR bus as a parent and the PCI bus
as a child. The the device tree listing is from my 9500 and contains debugging
nodes called /wayne.device@E and /wayne.device@F.</p>

<p>
Since we are at the root node, let's look at the pwd, .properties, and words
words. Enter the following.
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; pwd / ok
0 &gt; .properties
name                    device-tree
model                   Power Macintosh
compatible              AAPL,9500
MacRISC
AAPL,cpu-id             3900A69D
#address-cells          00000001
#size-cells             00000001
clock-frequency         02FAF080

ok
0 &gt; words
dma-sync        dma-map-out     dma-map-in      dma-free
dma-alloc       map-out map-in          decode-unit
close           open
ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>&lt; pwd &gt; displays the full path name for the current node. In this case
pwd displays the root node.</p>

<p>&lt; .properties &gt; listed all properties under this node (which is the AR
bus). Note that although the &lt; pwd &gt; word listed the node name as/, its
proper node name is device-tree. Look at the clock-frequency property, which is
0x02FAF080 (or 50MHz).</p>

<p>
&lt; words &gt; listed the words ( methods ) implemented by this node. But what
do these words do? Well, enter &lt; see &gt; and then the word you want to see,
such as &lt; open &gt;.
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; see open
: open
true
; ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>So &lt; open &gt; just places the logical value of &lt; true &gt; onto the top
of the stack.</p>

<p>
Now let's look at one last maneuver - traversing the tree to another node. For
this example, we'll look at the node called wayne at the top location in the
tree.
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; dev /bandit@F2000000/wayne.device  ok
0 &gt; pwd /bandit@F2000000/wayne.device@E ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<br><center><table width="550" border="0">
<tbody><tr><td bgcolor="#E6E6E6" align="left">
<p><b>Note:</b><br>
The node chosen was the first of two. </p>
</td></tr></tbody></table></center><br>


<p>
What if we had wanted the second node? Replacing the @E with @F would have
chosen that node. Also note that the &lt; pwd &gt; word showed the name of the
node. Typing long path names is subject to mistakes, so let's look at an
alternative method. Enter the word &lt; devalias &gt; to see the following: 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; devalias
vci0                /chaos@F0000000
pci1                /bandit@F2000000
pci2                /bandit@F4000000
fd                  /bandit/gc/swim3
kbd                 /bandit/gc/via-cuda/adb/keyboard
ttya                /bandit/gc/escc/ch-a
ttyb                /bandit/gc/escc/ch-b
enet                /bandit/gc/mace
scsi                /bandit/gc/53c94
scsi-int            /bandit/gc/mesh
ok
</pre>
	</td>
</tr>
</tbody></table></center>

<p>Look at the second entry called pci1.</p>
<p>
Now enter: 
</p>

<center><table width="550" cellpadding="5" border="0">
<tbody><tr>
	<td bgcolor="#E6E6E6" align="left">
<pre>0 &gt; dev pci1/@e  ok
0 &gt; pwd /bandit@F2000000/wayne.device@E ok
0 &gt;
</pre>
	</td>
</tr>
</tbody></table></center>

<p>Cool huh? pci1 is an alias of /bandit@F2000000.</p>

<br><center><table width="550" border="0">
<tbody><tr><td bgcolor="#E6E6E6" align="left">
<p><b>Note:</b><br>
@e or @E (not case sensitive) is also a valid name for a node. </p>
</td></tr></tbody></table></center><br>

        


<p><a href="#top">Back to top</a></p>
<a name="Summary"></a>
<h2>Summary</h2>
<p>
There is much more yet to be described about using Open Firmware to build and
debug your drivers and devices. The next Technote in this series, <i>Technote
1062 - Fundamentals of Open Firmware, Part II: The Device Tree,</i> which will be available soon, addresses
details of working with the device tree.
</p>

<p><a href="#top">Back to top</a></p>
<a name="References"></a>

<h2>References</h2>
<p>IEEE 1275-1994 Specification</p>
<p>PCI Local Bus Specification 2.0</p>
<p>PCI Bus Binding Specification 1.5</p>
<p><i>Designing PCI Cards and Drivers for Power Macintosh Computers</i></p>
<p><a href="https://developer.apple.com/library/archive/technotes/tn/tn1044.html">
<i>Technote 1044 - Understanding PCI Expansion ROM Choices for Mac OS8</i></a>, 
Part III in the Open Firmware Technote Series</p>



<p><a href="#top">Back to top</a></p>


         <p><a name="Downloads"></a></p>
         
         <h2>Downloadables</h2>
         
         <table width="500" cellpadding="3" border="0">
            <tbody><tr>
               <td width="50" align="left">
                  <p align="center"><img src="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/acrobatsmall.gif" alt="Acrobat" width="22" height="23" align="middle"></p>
               </td>
               <td align="left">
                  <p>Acrobat version of this Note (84K).</p>
               </td>
               <td width="60" align="left">
                  <p><a href="https://developer.apple.com/library/archive/technotes/tn/pdf/tn1061.pdf">Download</a></p>
               </td>
            </tr>
</tbody></table>



<p><a href="#top">Back to top</a></p>


</td></tr></tbody></table></center>

<!-- begin_footer_information -->

<div id="globalfooter" class="hideInXcode hideOnPrint">
	<div class="gf-sosumi">
	    <p>Copyright © 2016 Apple Inc. All rights reserved.</p>
	    <ul class="piped">
		    <li><a href="http://www.apple.com/legal/internet-services/terms/site.html" class="first" target="_blank">Terms of Use</a></li>
		    <li><a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a></li>
	    </ul>
	</div>
</div><!--/globalfooter-->
<!-- end_footer_information -->




</div>
            </article>

<script type="text/javascript" src="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/prototype.js"></script>
<script type="text/javascript" src="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/library.js"></script>
<script type="text/javascript" src="Technical%20Note%20TN1061%20Fundamentals%20of%20Open%20Firmware,%20Part%20I%20The%20User%20Interface_files/feedback.js"></script>



<div id="blackout">
    <div id="preload"></div>
</div><div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback…</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We’re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1"> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2"> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3"> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo"> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect"> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples"> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art"> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo"> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required=""></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send">

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="https://developer.apple.com/bugreporter/" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div></body></html>